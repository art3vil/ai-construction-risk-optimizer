import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ú–ï–ù –ò –ü–û–î–°–ö–ê–ó–û–ö (–°–ª–æ–≤–∞—Ä—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞) ---
INDICATOR_CONFIG = {

    # -------------------------
    # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    # -------------------------

    "planned_budget": {
        "label": "–ü–ª–∞–Ω–æ–≤—ã–π –±—é–¥–∂–µ—Ç (—Ä—É–±.)",
        "desc": "–û–∂–∏–¥–∞–µ–º—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞.",
        "impact": "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é –º–∞—Ä–∂—É."
    },

    "actual_cost": {
        "label": "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã (—Ä—É–±.)",
        "desc": "–†–µ–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞.",
        "impact": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞."
    },

    "final_profit": {
        "label": "–ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å (—Ä—É–±.)",
        "desc": "–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ—Å–ª–µ —É—á–µ—Ç–∞ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ —à—Ç—Ä–∞—Ñ–æ–≤.",
        "impact": "–ì–ª–∞–≤–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    },

    "actual_margin": {
        "label": "–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∂–∞ (%)",
        "desc": "–û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ –≤—ã—Ä—É—á–∫–µ.",
        "impact": "–°–Ω–∏–∂–µ–Ω–∏–µ –º–∞—Ä–∂–∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏."
    },

    "budget_overrun": {
        "label": "–§–ª–∞–≥ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –±—é–¥–∂–µ—Ç–∞",
        "desc": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏ –∑–∞—Ç—Ä–∞—Ç—ã –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–æ—Ä–æ–≥.",
        "impact": "–í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–æ–≤ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è."
    },

    # -------------------------
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    # -------------------------

    "planned_duration_days": {
        "label": "–ü–ª–∞–Ω–æ–≤–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π)",
        "desc": "–û–∂–∏–¥–∞–µ–º—ã–π —Å—Ä–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.",
        "impact": "–ß–µ–º –¥–ª–∏–Ω–Ω–µ–µ —Å—Ä–æ–∫, —Ç–µ–º –≤—ã—à–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏."
    },

    "delay_days": {
        "label": "–ó–∞–¥–µ—Ä–∂–∫–∞ —Å—Ä–æ–∫–æ–≤ (–¥–Ω–µ–π)",
        "desc": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –≥—Ä–∞—Ñ–∏–∫–∞.",
        "impact": "–í–µ–¥–µ—Ç –∫ —à—Ç—Ä–∞—Ñ–∞–º –∏ —Å–Ω–∏–∂–µ–Ω–∏—é –¥–æ–≤–µ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤."
    },

    # -------------------------
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–∞
    # -------------------------

    "house_area_m2": {
        "label": "–ü–ª–æ—â–∞–¥—å –¥–æ–º–∞ (–º¬≤)",
        "desc": "–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç—Ä–æ—è—â–µ–≥–æ—Å—è –æ–±—ä–µ–∫—Ç–∞.",
        "impact": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –≤—ã—Ä—É—á–∫—É."
    },

    "design_complexity": {
        "label": "–°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–∏–∑–∞–π–Ω–∞",
        "desc": "–£—Ä–æ–≤–µ–Ω—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.",
        "impact": "–ü–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞."
    },

    "materials_class": {
        "label": "–ö–ª–∞—Å—Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
        "desc": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.",
        "impact": "–í–ª–∏—è–µ—Ç –Ω–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä—ã–Ω–∫–µ."
    },

    # -------------------------
    # –ó–µ–º–ª—è –∏ –ª–æ–∫–∞—Ü–∏—è
    # -------------------------

    "district_class": {
        "label": "–ö–ª–∞—Å—Å —Ä–∞–π–æ–Ω–∞",
        "desc": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ª–æ–∫–∞—Ü–∏–∏ (—ç–∫–æ–Ω–æ–º, —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –ø—Ä–µ–º–∏—É–º).",
        "impact": "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–µ–º–ª–∏ –∏ –∫–æ–Ω–µ—á–Ω—É—é —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏."
    },

    "land_price_per_m2": {
        "label": "–¶–µ–Ω–∞ –∑–µ–º–ª–∏ –∑–∞ –º¬≤",
        "desc": "–°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∫–∞ –ø–æ–¥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ.",
        "impact": "–í—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏."
    },

    "land_area_m2": {
        "label": "–ü–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞ (–º¬≤)",
        "desc": "–†–∞–∑–º–µ—Ä –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞.",
        "impact": "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞."
    },

    "soil_complexity": {
        "label": "–°–ª–æ–∂–Ω–æ—Å—Ç—å –≥—Ä—É–Ω—Ç–∞",
        "desc": "–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞.",
        "impact": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–¥–æ—Ä–æ–∂–∞–Ω–∏—è —Ä–∞–±–æ—Ç."
    },

    "site_accessibility": {
        "label": "–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—á–∞—Å—Ç–∫–∞",
        "desc": "–û—Ü–µ–Ω–∫–∞ —É–¥–æ–±—Å—Ç–≤–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π.",
        "impact": "–°–Ω–∏–∂–∞–µ—Ç –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã."
    },

    # -------------------------
    # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
    # -------------------------

    "crew_experience_years": {
        "label": "–û–ø—ã—Ç –±—Ä–∏–≥–∞–¥—ã (–ª–µ—Ç)",
        "desc": "–°—Ä–µ–¥–Ω–∏–π —Å—Ç–∞–∂ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã.",
        "impact": "–ë–æ–ª–µ–µ –æ–ø—ã—Ç–Ω—ã–µ –±—Ä–∏–≥–∞–¥—ã —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫."
    },

    "crew_efficiency_score": {
        "label": "–ò–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±—Ä–∏–≥–∞–¥—ã",
        "desc": "–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.",
        "impact": "–ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –∑–∞–¥–µ—Ä–∂–µ–∫."
    },

    "crew_current_load": {
        "label": "–¢–µ–∫—É—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±—Ä–∏–≥–∞–¥—ã",
        "desc": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.",
        "impact": "–í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ä—ã–≤–æ–≤ —Å—Ä–æ–∫–æ–≤."
    },

    "supplier_reliability_score": {
        "label": "–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
        "desc": "–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ—Å—Ç–∞–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.",
        "impact": "–ù–∏–∑–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–±–æ—Ç."
    },

    "delivery_distance_km": {
        "label": "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ (–∫–º)",
        "desc": "–£–¥–∞–ª–µ–Ω–Ω–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –æ—Ç –æ–±—ä–µ–∫—Ç–∞.",
        "impact": "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –∏ —Ä–∏—Å–∫ –∑–∞–¥–µ—Ä–∂–µ–∫."
    },

    # -------------------------
    # –†—ã–Ω–æ—á–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
    # -------------------------

    "material_price_index": {
        "label": "–ò–Ω–¥–µ–∫—Å —Ü–µ–Ω –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
        "desc": "–û—Ç—Ä–∞–∂–∞–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.",
        "impact": "–†–æ—Å—Ç –∏–Ω–¥–µ–∫—Å–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞."
    },

    "mortgage_rate": {
        "label": "–°—Ç–∞–≤–∫–∞ –ø–æ –∏–ø–æ—Ç–µ–∫–µ (%)",
        "desc": "–°—Ä–µ–¥–Ω–µ—Ä—ã–Ω–æ—á–Ω–∞—è –∏–ø–æ—Ç–µ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞.",
        "impact": "–†–æ—Å—Ç —Å—Ç–∞–≤–∫–∏ —Å–Ω–∏–∂–∞–µ—Ç —Å–ø—Ä–æ—Å –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å."
    },

    "market_demand_index": {
        "label": "–ò–Ω–¥–µ–∫—Å —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Å–ø—Ä–æ—Å–∞",
        "desc": "–û—Ü–µ–Ω–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –Ω–∞ —Ä—ã–Ω–∫–µ.",
        "impact": "–í—ã—Å–æ–∫–∏–π —Å–ø—Ä–æ—Å –ø–æ–≤—ã—à–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—É—é —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏."
    },

    # -------------------------
    # ML-–º–µ—Ç—Ä–∏–∫–∏
    # -------------------------

    "Risk_Score": {
        "label": "–ò–Ω–¥–µ–∫—Å —Ä–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞",
        "desc": "–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –±—é–¥–∂–µ—Ç–∞ –ø–æ –º–æ–¥–µ–ª–∏ (0‚Äì1).",
        "impact": "–ó–Ω–∞—á–µ–Ω–∏–µ –≤—ã—à–µ 0.6 —Ç—Ä–µ–±—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞."
    }
}

def get_label(var_name):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Å–∏–≤–æ–µ –∏–º—è, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ, –∏–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∞–º–æ –∏–º—è"""
    return INDICATOR_CONFIG.get(var_name, {}).get("label", var_name)


def get_help(var_name):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤–ª–∏—è–Ω–∏–µ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏"""
    info = INDICATOR_CONFIG.get(var_name, {})
    if info:
        return f"**–°—É—Ç—å:** {info['desc']}\n\n**–í–ª–∏—è–Ω–∏–µ:** {info['impact']}"
    return "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä."


# --- –ù–ê–°–¢–†–û–ô–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
st.set_page_config(page_title="Risk Analytics Pro", page_icon="üèóÔ∏è", layout="wide")

st.markdown("""
    <style>
    .stMetric { border: 1px solid #e6e9ef; padding: 10px; border-radius: 5px; background: #fafafa; }
    </style>
""", unsafe_allow_html=True)

st.title("üèóÔ∏è –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤")

tab1, tab2, tab3 = st.tabs(["üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –ü—Ä–æ–≥–Ω–æ–∑—ã", "üìñ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π", "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"])

# --- –í–ö–õ–ê–î–ö–ê: –°–ü–†–ê–í–û–ß–ù–ò–ö ---
with tab2:
    st.header("–û–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π")
    help_list = []
    for key, val in INDICATOR_CONFIG.items():
        help_list.append({"–ü–∞—Ä–∞–º–µ—Ç—Ä": val['label'], "–û–ø–∏—Å–∞–Ω–∏–µ": val['desc'], "–ë–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç": val['impact']})
    st.table(pd.DataFrame(help_list))

# --- –í–ö–õ–ê–î–ö–ê: –ò–ù–°–¢–†–£–ö–¶–ò–Ø ---
with tab3:
    st.header("–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    st.markdown("""
    1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ** (CSV —Ñ–∞–π–ª) –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏.
    2. –í —Ä–∞–∑–¥–µ–ª–µ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** –≤—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å.
    3. –ù–∞–∂–º–∏—Ç–µ **–û–±—É—á–∏—Ç—å –ò–ò** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.
    4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ **–°–∏–º—É–ª—è—Ç–æ—Ä—É** –∏ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
    """)

# --- –í–ö–õ–ê–î–ö–ê: –†–ê–ë–û–ß–ê–Ø –û–ë–õ–ê–°–¢–¨ ---
with tab1:
    st.sidebar.header("üìÅ –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö")
    uploaded_file = st.sidebar.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–æ–≤ (CSV)", type=["csv"])

    if uploaded_file:
        df = pd.read_csv(uploaded_file)
    else:
        try:
            df = pd.read_csv('construction_data.csv')
            st.sidebar.success("–ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.")
        except:
            st.info("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∞.")
            st.stop()

    # –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ)
    df_encoded = df.copy()
    label_encoders = {}
    for col in df_encoded.columns:
        if df_encoded[col].dtype == 'object':
            le = LabelEncoder()
            df_encoded[col] = le.fit_transform(df_encoded[col].astype(str))
            label_encoders[col] = le

    st.subheader("üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è")
    col_l, col_r = st.columns(2)

    with col_l:
        # –í selectbox –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –ö–†–ê–°–ò–í–´–ï –∏–º–µ–Ω–∞ —á–µ—Ä–µ–∑ format_func
        target_col = st.selectbox(
            "–ß—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º?",
            options=df.columns,
            format_func=get_label
        )

    with col_r:
        feature_cols = st.multiselect(
            "–ß—Ç–æ —É—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ?",
            options=[c for c in df.columns if c != target_col],
            default=[c for c in df.columns if c != target_col],
            format_func=get_label
        )

    if st.button("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—á–µ—Ç—ã –ò–ò"):
        X = df_encoded[feature_cols]
        y = df_encoded[target_col]
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

        model = RandomForestRegressor(n_estimators=100, random_state=42)
        model.fit(X_train, y_train)

        st.session_state['model'] = model
        st.session_state['features'] = feature_cols
        st.session_state['target'] = target_col

        acc = model.score(X_test, y_test)
        st.success(f"–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –¢–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏: {acc * 100:.1f}%")

    # –°–ò–ú–£–õ–Ø–¢–û–† –î–õ–Ø –ö–õ–ò–ï–ù–¢–ê
    if 'model' in st.session_state:
        st.divider()
        st.header("‚öôÔ∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤")
        st.write("–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –ò–ò –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:")

        user_input = {}
        s_cols = st.columns(2)

        for i, col_name in enumerate(st.session_state['features']):
            with s_cols[i % 2]:
                label = get_label(col_name)  # –ö—Ä–∞—Å–∏–≤–æ–µ –∏–º—è
                help_text = get_help(col_name)  # –ü–æ–¥—Å–∫–∞–∑–∫–∞

                if col_name in label_encoders:
                    options = label_encoders[col_name].classes_
                    selected_option = st.selectbox(f"{label}", options, help=help_text)
                    user_input[col_name] = label_encoders[col_name].transform([selected_option])[0]
                else:
                    min_v, max_v = float(df[col_name].min()), float(df[col_name].max())
                    user_input[col_name] = st.slider(f"{label}", min_v, max_v, float(df[col_name].mean()),
                                                     help=help_text)

        # –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï
        pred_val = st.session_state['model'].predict(pd.DataFrame([user_input]))[0]

        st.markdown("---")
        res_1, res_2 = st.columns([1, 2])
        with res_1:
            st.metric(f"–ü—Ä–æ–≥–Ω–æ–∑: {get_label(st.session_state['target'])}", f"{pred_val:.2f}")

        with res_2:
            st.subheader("–í—ã–≤–æ–¥ —Å–∏—Å—Ç–µ–º—ã:")
            avg = df[st.session_state['target']].mean()
            diff = ((pred_val / avg) - 1) * 100

            if diff > 15:
                st.warning(f"–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ {diff:.1f}% –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤.")
            elif diff < -15:
                st.success(f"–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ {abs(diff):.1f}% –ª—É—á—à–µ —Å—Ä–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π. –°—Ü–µ–Ω–∞—Ä–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω.")
            else:
                st.info("–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ä–µ–¥–Ω–µ—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º –Ω–æ—Ä–º–∞–º –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤.")


